<!doctype html><html lang="en"><head><meta charset="utf-8"><title>Polymer in Production — WebComponents.org</title><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1"><meta name="google-site-verification" content="px-LvGmZP4t9mI3QVcWkTYciiRbToixpY-F-NfIybaE"><meta name="author" content="Community"><meta name="description" content="Lessons learnt from deploying Polymer in a production environment.
"><meta name="theme-color" content="#3a99d7"><meta property="og:title" content="Polymer in Production — WebComponents.org"><meta property="og:image" content="https://webcomponents.github.io/img/stories/polymer-in-production.jpg"><meta property="og:url" content="https://webcomponents.github.io/articles/polymer-in-production"><meta property="og:description" content="Lessons learnt from deploying Polymer in a production environment.
"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Polymer in Production — WebComponents.org"><meta name="twitter:description" content="Lessons learnt from deploying Polymer in a production environment.
"><meta name="twitter:image" content="https://webcomponents.github.io/img/stories/polymer-in-production.jpg"><meta name="twitter:site" content="@Web_Components"><link rel="stylesheet" href="https://webcomponents.github.io/css/main.min.css"><link rel="stylesheet" href="https://webcomponents.github.io/css/syntax-highlight.min.css"><!--[if lt IE 10]>
    <link rel="stylesheet" media="all" href="https://webcomponents.github.io/css/ielt10.min.css">
    <![endif]--><link rel="icon" type="image/x-icon" href="https://webcomponents.github.io/img/favicon.ico"><link rel="publisher" href="https://plus.google.com/+WebcomponentsOrg"><script src="//use.typekit.net/ksn6mlw.js"></script><script>try{Typekit.load();}catch(e){}</script></head><body><div class="page-wrap"><header class="header-bar" role="banner"><div class="wrapper"><a class="logo" href="https://webcomponents.github.io"><img src="https://webcomponents.github.io/img/logo.svg" alt="WebComponents.org" width="60" height="39"> </a><a class="menu-button"><span></span> <span></span> <span></span></a><nav class="nav desktop-only" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement"><ul><li class="nav-item"><a href="https://webcomponents.github.io/" class="nav-link" title="Home" itemprop="url"><span itemprop="name">Home</span></a></li><li class="nav-item"><a href="https://webcomponents.github.io/polyfills/" class="nav-link" title="Polyfills" itemprop="url"><span itemprop="name">Polyfills</span></a></li><li class="nav-item nav-active"><a href="https://webcomponents.github.io/articles/" class="nav-link" title="Articles" itemprop="url"><span itemprop="name">Articles</span></a></li><li class="nav-item"><a href="https://webcomponents.github.io/presentations/" class="nav-link" title="Presentations" itemprop="url"><span itemprop="name">Presentations</span></a></li><li class="nav-item"><a href="https://webcomponents.github.io/podcasts/" class="nav-link" title="Podcasts" itemprop="url"><span itemprop="name">Podcasts</span></a></li><li class="nav-item"><a href="https://webcomponents.github.io/resources/" class="nav-link" title="Resources" itemprop="url"><span itemprop="name">Resources</span></a></li></ul></nav><script>(function() {
            var cx = '006706517617519397807:s_k6dwkdtby';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
        })();</script><div class="search-box desktop-only"><gcse:search></gcse:search></div></div></header><div class="notification_toolbar"><p class="notification_toolbar__header">Please help us make Web Components & PWA's better by completing <a target="_blank" href="https://bit.ly/web-survey-2016">this survey</a></p></div><div class="wrapper"><main class="layout-single" role="main" itemscope itemtype="http://schema.org/TechArticle"><div class="single-content" role="article"><section class="card card-story" role="region"><div class="story-image"><img src="https://webcomponents.github.io/img/stories/polymer-in-production.jpg" alt="Polymer in Production" itemprop="image"></div><p class="title" itemprop="name">Polymer in Production</p><div class="post-info" role="complementary"><p class="post-author">By <a href="https://twitter.com/pixelcodeuk" target="_blank">Mark Wheeler</a></p><p class="post-date" itemprop="datePublished"><span class="icon-clock"></span> January 26th, 2016</p></div><div class="description" itemprop="text"><p>Lessons learnt from deploying Polymer in a production environment.</p><h1 id="bower-bingo">Bower bingo</h1><p>At the time of writing, Polymer was dependent on <a href="http://bower.io/">Bower</a> to maintain and install itself and other components. One of the problems is when using large element bases like Google&#39;s <a href="https://elements.polymer-project.org">Paper Elements</a> is that you have a large Bower file to maintain, and on top of that even if you explicitly pin a specific version of a component, it can still itself pull in other dependent elements.</p><p>Three solutions are:</p><h2 id="manually-pin-all-elements-and-their-dependencies">Manually pin all elements and their dependencies</h2><p>Pros: Complete control over all elements<br>Cons: Laborious to maintain</p><h2 id="commit-bower-components-to-a-repository">Commit Bower components to a repository</h2><p>Pros: You can simplify your Bower file, and have confidence in the code going into production<br>Cons: Large and messy repository</p><h2 id="commit-bower-components-to-a-separate-location">Commit Bower components to a separate location</h2><p>Pros: Confidence in code going from testing into production<br>Cons: Extra build step required to pull this into codebase</p><p>NPM has a useful <a href="https://docs.npmjs.com/cli/shrinkwrap">shrinkwrap</a> ability that would alleviate the problems above.</p><p>Polymer NPM support issues:</p><ul><li><a href="https://github.com/Polymer/polymer/issues/2578#issuecomment-151580862">https://github.com/Polymer/polymer/issues/2578#issuecomment-151580862</a></li><li><a href="https://github.com/Polymer/polymer/issues/2525#issuecomment-145355985">https://github.com/Polymer/polymer/issues/2525#issuecomment-145355985</a></li></ul><h1 id="gulp-build">Gulp build</h1><p>Polymer has a vulcanization step that combines all the web components needed into one dependent file (rather than lots of smaller files). This step can be added to gulp:</p><pre class="highlight"><code class="hljs javascript"><span class="hljs-keyword">var</span> polybuild = <span class="hljs-built_in">require</span>(<span class="hljs-string">'polybuild'</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">vulc</span><span class="hljs-params">(name,output)</span></span>{
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">return</span> gulp.src(name)
    .pipe(polybuild({maximumCrush: <span class="hljs-literal">true</span>}))
    .pipe(gulp.dest(output));
  }
}

gulp.task(<span class="hljs-string">'vulcanize_homepage'</span>,vulc(<span class="hljs-string">'src/homepage.html'</span>,<span class="hljs-string">'dist/'</span>));
</code></pre><p><a href="https://github.com/PolymerLabs/polybuild">Polybuild</a> is a tool that lives on top of vulcanize and makes it super easy to vulcanise a file and split the output into two files (one JS and one HTML). The example above combines all the imports for the homepage and saves the output in the <em>dist</em> directory.</p><p>When developing your site, vulcanization is not necessary, so you can simplify your pipeline by having two gulp tasks, one for dev that runs and CSS tasks etc and one for production that has the vulcanization step afterwards.</p><pre class="highlight"><code class="hljs handlebars"><span class="xml"></span><span class="hljs-expression">{{<span class="hljs-begin-block">#<span class="hljs-keyword">if</span> vulcanized</span>}}</span><span class="xml">
  <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"import"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/dist/page-home.build.html"</span> /&gt;</span>
</span><span class="hljs-expression">{{<span class="hljs-variable"><span class="hljs-keyword">else</span></span>}}</span><span class="xml">
  <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"import"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/bower_components/polymer/polymer.html"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"import"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/src/page-home.html"</span> /&gt;</span>
</span><span class="hljs-expression">{{<span class="hljs-end-block">/<span class="hljs-keyword">if</span></span>}}</span><span class="xml">
</span></code></pre><p>The example above is a templated HTML file that can serve both development purposes, and QA/production purposes depending on whether an environment variable is set.</p><h2 id="polylint">Polylint</h2><p><a href="https://github.com/PolymerLabs/polylint">Polylint</a> does a very basic sanity check of your elements (and follows the dependency chain) giving you some piece of mind in the build process.</p><pre class="highlight"><code class="hljs javascript"><span class="hljs-keyword">var</span> polylint = <span class="hljs-built_in">require</span>(<span class="hljs-string">'polylint'</span>);
<span class="hljs-keyword">var</span> colors = <span class="hljs-built_in">require</span>(<span class="hljs-string">'colors/safe'</span>);

gulp.task(<span class="hljs-string">'polylint'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(cb)</span> </span>{
  <span class="hljs-keyword">var</span> errors = polylint(<span class="hljs-string">'src/elements.html'</span>);

  errors.then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(errors)</span></span>{
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;i &lt; errors.length;i++) {
      <span class="hljs-keyword">var</span> warning = errors[i];
      warning = colors.red(warning.filename) + <span class="hljs-string">":"</span> +
        warning.location.line + <span class="hljs-string">":"</span> + warning.location.column +
        <span class="hljs-string">"\n    "</span> + colors.gray(warning.message);
      <span class="hljs-built_in">console</span>.log(warning);
    }
    cb();
  });
});
</code></pre><p>The example above starts at the file <em>src/elements.html</em> and lints and follows the dependency tree and prints its output.</p><h1 id="docker">Docker</h1><p>Once you have a build pipeline (and a way to control external dependencies), one deployment option is Docker. You can deploy your code, and get Docker to build the distribution environment.</p><pre class="highlight"><code class="hljs gradle">RUN node_modules<span class="hljs-regexp">/.bin/gu</span>lp polymer_dist
</code></pre><p>The above example calls <code>gulp polymer_dist</code> assuming that everything needed to deploy is contained inside the gulp task.</p><p>Docker&#39;s image environment lends itself to a Polymer build system due to the dependencies required. A project can contain many web components made by other people, and a Docker image (when built) will contain a working point in time fixing all dependencies to the version at the point of creation (making rollback easy).</p><h2 id="serving-polymer-content">Serving Polymer content</h2><p>Once you have built your site, you need a way of serving the content. If your site is purely static you can simply serve the HTML/JS/CSS statically.</p><p>If however you want to modify the HTML output you can use any templating solution with a server such as <em>express</em>:</p><pre class="highlight"><code class="hljs 1c"><span class="hljs-comment">//Docker</span>
CMD [ <span class="hljs-string">"node"</span>, <span class="hljs-string">"index"</span> ]
</code></pre><pre class="highlight"><code class="hljs actionscript"><span class="hljs-comment">//index.js</span>

<span class="hljs-keyword">var</span> express = require(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> app = express();

<span class="hljs-comment">//Setup routes</span>

app.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/profile'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span> </span>{
  <span class="hljs-comment">//Cache for 5 seconds</span>
  res.header(<span class="hljs-string">'Cache-Control'</span>, <span class="hljs-string">'max-age=5'</span>);

  <span class="hljs-comment">//Render page</span>
  res.render(<span class="hljs-string">'profile'</span>,{
      <span class="hljs-comment">//Template parameters</span>
  });
});

<span class="hljs-comment">//Serve static files, + send cache time</span>
app.<span class="hljs-keyword">use</span>(express.<span class="hljs-keyword">static</span>(__dirname + <span class="hljs-string">'/dist/'</span>,{maxAge : <span class="hljs-string">'60s'</span>}));
</code></pre><p>The first code snippet runs <em>node</em> at the end of the Docker build steps.</p><p>The second, is the <em>express</em> server with one route (the gets a profile and allows you to modify data if required), and serves other content statically (the compiled JS for example).</p><h2 id="global-variables">Global variables</h2><p>The advantage of templating is that you can keep the same code for the website and using environment variables switch between a staging environment (QA) and the live environment.</p><pre class="highlight"><code class="hljs handlebars"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
  <span class="hljs-built_in">window</span>.MyGlobals = <span class="hljs-built_in">window</span>.MyGlobals || {};
  <span class="hljs-built_in">window</span>.MyGlobals.APIURL = <span class="hljs-string">'</span></span></span><span class="hljs-expression">{{<span class="hljs-variable">APIADDRESS</span>}}</span><span class="xml"><span class="javascript"><span class="hljs-string">';
</span></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</span></code></pre><p>Using the above code, your Polymer project can reference <code>window.MyGlobals.APIURL</code> when it needs to make a network request and not have any knowledge of the environment it&#39;s in.</p><h1 id="caching-and-versioning">Caching and versioning</h1><p>As Polymer files are static in nature, once they are built they can be cached indefinitely. Versioning your HTML / JS output from a Polybuild and serving from a CDN will reduce costs and increase performance of your application.</p><p>The files that have templated information can also be cached by using the appropriate headers from your server (<em>express</em> example above).</p><p>Fixed template variables (such as API endpoints) can be merged into the build step and cached indefinitely in the output.</p><h1 id="preloading-images-and-data">Preloading images and data</h1><p>Polymer projects can build single page web apps, and all data can be loaded asynchronously using AJAX. The problem is that none of these calls will be made until Polymer has finished loading and upgrading the elements.</p><p>If you have any data which you know in advance, you can build it into your pipeline so that when Polymer requests the data the browser already has it in its cache.</p><p>For example if you have some dynamic images loading above-the-fold (and you can compute what they will be ahead of time) you can inject JavaScript into your page to fetch these as soon as the page starts to load so they are warm in the cache when Polymer requests them (when using <a href="https://github.com/PolymerElements/iron-image">iron-image</a> for example).</p><p>As browser performance increases (and HTTP 2.0 is introduced) these optimisations will not be necessary.</p><h1 id="google-analytics">Google Analytics</h1><p>Using Google Analytics, you can view your rendering times across your user base which gives a good indicator of your Polymer performance (from server response time to browser render time). You can create custom dashboards to monitor the stats you need the most (browser usage, popular pages render time etc).</p><h1 id="full-polymer-website-examples">Full Polymer website examples</h1><ul><li><a href="http://gaming.youtube.com">YouTube Gaming</a></li><li><a href="https://elements.polymer-project.org">Polymer Catalog</a></li><li><a href="https://wakelet.com">Wakelet</a></li></ul></div></section><div class="card card-comments"><div id="disqus_thread"></div><script>var disqus_shortname = 'webcomponentsorg';

                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();</script></div></div><div class="single-sidebar"><section class="card card-author" role="region" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="author-avatar" src="https://2.gravatar.com/avatar/6080ee366cd84e86d613922de2bb08de" alt="Mark Wheeler" itemprop="image"><p class="author-name" itemprop="name">Mark Wheeler</p><p class="author-twitter"><a href="https://twitter.com/pixelcodeuk" target="_blank" itemprop="url">@pixelcodeuk</a></p><p class="author-bio" itemprop="description">Mark is a creative technologist and CTO.</p></section><section class="card card-tags" role="region" itemscope itemtype="http://schema.org/ItemList"><h3 itemprop="name">Tags</h3><ul class="tag-list"><li itemprop="itemListElement" itemscope itemtype="http://schema.org/ItemList"><a href="/tags/custom-elements" itemprop="url"><span class="icon icon-tag"></span> <span itemprop="name">Custom Elements</span></a></li><li itemprop="itemListElement" itemscope itemtype="http://schema.org/ItemList"><a href="/tags/polymer" itemprop="url"><span class="icon icon-tag"></span> <span itemprop="name">Polymer</span></a></li><li itemprop="itemListElement" itemscope itemtype="http://schema.org/ItemList"><a href="/tags/production" itemprop="url"><span class="icon icon-tag"></span> <span itemprop="name">Production</span></a></li></ul></section></div></main></div></div><div class="aux-nav"><nav class="wrapper" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement"><ul><li>Learn</li><li><a href="https://webcomponents.github.io/articles/" title="Articles" itemprop="url"><span itemprop="name">Articles</span></a></li><li><a href="https://webcomponents.github.io/presentations/" title="Presentations" itemprop="url"><span itemprop="name">Presentations</span></a></li><li><a href="https://webcomponents.github.io/podcasts/" title="Podcasts" itemprop="url"><span itemprop="name">Podcasts</span></a></li></ul><ul><li>Code</li><li><a href="https://webcomponents.github.io/polyfills/" title="Polyfills" itemprop="url"><span itemprop="name">Polyfills</span></a></li><li><a href="https://webcomponents.github.io/resources/" title="Resources" itemprop="url"><span itemprop="name">Resources</span></a></li></ul><ul><li>Community</li><li><a href="https://webcomponents.github.io/about/" title="About" itemprop="url"><span itemprop="name">About</span></a></li><li><a href="https://webcomponents.github.io/assets/" title="Assets" itemprop="url"><span itemprop="name">Assets</span></a></li><li><a href="https://webcomponents.github.io/swags/" title="Swags" itemprop="url"><span itemprop="name">Swags</span></a></li></ul></nav></div><footer class="credits" role="contentinfo"><div class="wrapper"><p>Made with <span class="love">♥</span> by the <a target="_blank" class="credits-link" href="https://github.com/webcomponents/webcomponents.github.io/graphs/contributors" itemprop="publisher">WebComponents.org contributors.</a></p><ul class="social-buttons"><li class="tweet-btn"><iframe src="http://platform.twitter.com/widgets/tweet_button.1359159993.html#_=1360010161235&amp;count=horizontal&amp;id=twitter-widget-0&amp;lang=en&amp;size=m&amp;url=https://webcomponents.github.io&amp;text=WebComponents.org ~ A place to discuss and evolve Web Component best-practices" class="twitter-share-button twitter-count-horizontal" data-twttr-rendered="true" allowtransparency="true" frameborder="0" scrolling="no" width="100" height="20"></iframe></li><li class="fb-btn"><iframe src="//www.facebook.com/plugins/like.php?href=https://webcomponents.github.io&amp;send=false&amp;layout=button_count&amp;width=100&amp;show_faces=false&amp;font&amp;colorscheme=light&amp;action=like&amp;height=20&amp;appId=176947299114210" allowtransparency="true" frameborder="0" scrolling="no" width="85" height="20"></iframe></li><li class="gplus-btn"><iframe src="https://plusone.google.com/_/+1/fastbutton?bsv&amp;size=medium&amp;hl=en-US&amp;url=https://webcomponents.github.io&amp;parent=https://webcomponents.github.io" allowtransparency="true" frameborder="0" scrolling="no" width="70" height="20"></iframe></li><li class="github-btn"><iframe src="http://ghbtns.com/github-btn.html?user=webcomponents&amp;repo=webcomponents.github.io&amp;type=watch&amp;count=true&amp;size=small" allowtransparency="true" frameborder="0" scrolling="0" width="85" height="20"></iframe></li></ul></div></footer><script src="https://webcomponents.github.io/js/main.js"></script><script>window.__insp = window.__insp || [];
__insp.push(['wid', 1646634871]);
(function() {
    function __ldinsp(){var insp = document.createElement('script'); insp.type = 'text/javascript'; insp.async = true; insp.id = "inspsync"; insp.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://cdn.inspectlet.com/inspectlet.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(insp, x); }
    if (window.attachEvent){
        window.attachEvent('onload', __ldinsp);
    }else{
        window.addEventListener('load', __ldinsp, false);
    }
})();</script><script>var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-47408119-2']);
_gaq.push(['_trackPageview']);

(function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>